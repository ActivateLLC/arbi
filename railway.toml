[build]
builder = "nixpacks"
buildCommand = "PLAYWRIGHT_BROWSERS_PATH=/app/.playwright pnpm install --no-frozen-lockfile && PLAYWRIGHT_BROWSERS_PATH=/app/.playwright npx playwright install --with-deps && pnpm build"

[deploy]
startCommand = "PLAYWRIGHT_BROWSERS_PATH=/app/.playwright PLAYWRIGHT_BROWSERS_PATH=/app/.playwright pnpm --filter @arbi/api start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/health"
healthcheckTimeout = 100

[environments.production]
# rootDirectory must be root (.) to access workspace packages
# rootDirectory = "apps/api"
